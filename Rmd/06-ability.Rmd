# Comparing ability {#ch:ability}

## D-score distribution by study


```{r}

knitr::include_app("https://tnochildhealthstatistics.shinyapps.io/GCDG_references/", 
  height = "600px")
```
: (\@tab:dscorerefs) $D$-score distributions by study.


## Impact of measurement error

For each estimated $D$-score form the calibrated model, the precision of the
estimate can be determined. This precision can be expressed as the standard
error of measurement. The standard error of measurement is inversely related to
the number of items and to the test information. Thus, when more items are
administered for a person, the measurement error for the $D$-score of this
person will be smaller. Also, there is less measurement error when there is more
test information. $sem = \frac{1}{\sqrt{TI}}$, accordingly the Test information
($TI$) can be obtained as $TI = \frac{1}{sem^2}$ [REF: Embretson Reise]. The
test information depicts the information that is in the items that are
administered to obtain he $D$-score. Thus the test information for a person is
the sum of the ifnormation that each item contirbutes to the $D$-score for a
person.


```{r}
library("dmetric")
library("gseddata")
library("dplyr")

varlist <- list(adm = c("subjid", "agedays", "cohort", "cohortn", "subjido"),
                items = gcdg_items)
gcdg_lean <- get_data(cohorts = 40:56, items = varlist$items, adm = varlist$adm)

model_lean <- fit_dmodel(varlist, data = gcdg_lean, equate = gcdg_equatelist,
                    name = "565_18", age_unit = "years")

semdata <- model_lean$dscore %>%
  mutate(var = sem*sem, info = 1/var)
#remove outlier and South Africa cohort (has extremely high information, delutes the plot)
semdata <- semdata[-which(semdata$info==max(semdata$info, na.rm=TRUE)|semdata$cohort == "GCDG-ZAF"),]
 ggplot(data = semdata )+
  geom_smooth(aes(x=n, y=sem), se = FALSE, color = "red")+
  geom_smooth(aes(x=n, y=info), se = FALSE, color = "blue")+
  xlab("n")


```

sample variance = $\frac{\sum(D{i}^2 - D^2 - sem{i}^2)}{N-1}$
SEM population = sum()
SEM at each age group (each month) reflected in error bars around the average daz. 

```{r}
library("dmetric")
library("gseddata")
library("dplyr")

varlist <- list(adm = c("subjid", "agedays", "cohort", "cohortn", "subjido"),
                items = gcdg_items)
gcdg_lean <- get_data(cohorts = 40:56, items = varlist$items, adm = varlist$adm)

model_lean <- fit_dmodel(varlist, data = gcdg_lean, equate = gcdg_equatelist,
                    name = "565_18", age_unit = "years")

sem_daz_a <- model_lean$dscore %>%
  mutate(agemos = cut(a * 12, breaks = 0:max(a*12, na.rm=TRUE)), agenum = as.numeric(agemos)) %>% 
  group_by(agenum) %>% 
  summarize (daz = mean(daz, na.rm = TRUE), sem = mean(sem, na.rm=TRUE)/5) %>% 
  ungroup() %>%
  mutate(low = daz - sem, high = daz + sem) ####klopt dit? SEM moet omgezet naar daz units. nu sem/5. uitzoeken hoe?

#deze per studie ook toevoegen om verschil tussen studie te laten zien
ggplot(data = sem_daz_a )+
  geom_point(aes(x=agenum, y=daz)) +
  geom_errorbar(aes(x = agenum, ymin=low, ymax=high), width=.1)+
  xlab("age(months)")

## dan dat ook per cohort weergeven om verschillen tussen studies te zien? Misschien ook in shiny dat je kan doorklikken?



```

Per study. 


```{r}

knitr::include_app("https://tnochildhealthstatistics.shinyapps.io/GCDG_sem/", 
  height = "600px")
```
: (\@tab:dscoresems) Standard Error of Measurment by study.
